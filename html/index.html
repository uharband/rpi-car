<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>NippleJS</title>
        <meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5">
        <style>
        html, body {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 0;
            margin: 0;
        }

        #video {
            position: absolute;
            left: 0;
            top: 0;
            height: 50%;
            width: 100%;
            background: rgba(0, 255, 0, 0.1);
			margin-bottom:5px;
        }

        #remoteControl {
            position: absolute;
            left: 0;
            top: 50%;
            height: 50%;
            width: 100%;
            background: rgba(0, 0, 255, 0.1);
        }
		img {
			max-width: 100%;
			max-height: 100%;
			margin-left: auto;
			margin-right: auto;
			margin-bottom: 5px;
			display: block;			
		}
        </style>
    </head>
    <body>
        <div id="video"><img src="sunset.jpg"/></div>
        <div id="remoteControl"></div>
        <script src="./dist/nipplejs.js" charset="utf-8"></script>
        <script>
        var joystickR = nipplejs.create({
            zone: document.getElementById('remoteControl'),
            mode: 'static',
            position: { left: '50%', top: '50%' },
            color: 'red',
            size: 200
        });
		
		joystickR[0].on('start end dir plain move', function (evt, data) {
			console.log(evt);
			console.log(data);
			switch(evt.type){
                case 'move':
                    if(data.direction === undefined || data.distance === undefined){
                        return;
                    }
                    setState(data.direction.angle, Math.floor(data.distance/2 + 50));
                    break;
                case 'end':
                    stopCar();
                    break;
            }
        // DO EVERYTHING
		});
        </script>

        <script>

            function setStatus(status){
                console.log(status);
            }

            // ---  Car  ---- //
            function setState(direction, speed) {
                setStatus("setState entered");
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4){ //done with the request
                        if(this.status == 200) {
                            setStatus('setState ok')
                        }
                        else{
                            setStatus('setState not ok');
                        }
                    }
                };
                xhttp.open("GET", "/state?direction=" + direction + "&speed=" + speed, true);
                xhttp.send();
            }

            function stopCar() {
                setStatus("stopCar entered");
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4){ //done with the request
                        if(this.status == 200) {
                            setStatus('stop ok')
                        }
                        else{
                            setStatus('stop not ok');
                        }
                    }
                };
                xhttp.open("GET", "/stop", true);
                xhttp.send();
            }
        </script>

    </body>
</html>
